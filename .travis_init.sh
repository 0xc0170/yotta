#!/bin/bash
mkdir -p ~/.ssh
chmod 700 ~/.ssh
# don't check host keys -Â the tests need to access repos over ssh, which would
# otherwise stall asking about the server's fingerprint
echo -e 'Host bitbucket.org\n\tStrictHostKeyChecking no\n' >> ~/.ssh/config
# We also need an account to access things on bitbucket (our test packages), so
# we have a dummy account with this public private key:
echo -e "-----BEGIN RSA PRIVATE KEY-----\nMIIEpAIBAAKCAQEA/C5iyF6B2eM0U5vmpw3qu6r1sGrWII5mk9j5dK4xnUWfPqzF\n6TyVs3C69oT6VORI0z5fMpFYET8hNbaEMCg23S9LaYn420lrDmuEmrMmEod34E7w\nHr65tsJHaUtedIoua9vLBzLiq2k31uteF7EMIp8Ln3zlaPpaGj5Y9lj8fGATm9fS\nBvUR0msKKNIO4yU+xqIzPkKDA4h+fuBXL1J/5DUp96A22CD9xN8VfWJSEJXWAKas\nl6EH+5Rbyp8uFcJT3E2LhRnNwEJWkNpDXiOva7m2PsaIdN4x/DLLjG+A6minyVeS\nS2vBOFScChEhGn/x4pAz0kXF+wIYEyIeY76CdQIDAQABAoIBAQDkjhHfcbAUTxSM\ntl5ch4N4JSDZjGqXRRh45QxpkLrMxF3oiuQwWEWBRSld5fWP3PqX4g6boRkFQIcT\nzGCP2NKosoWRmIegDzFk91NOdhGKd5bRCBoec1OT7Q6VwsZPrzEVdjXTR24iVpFS\nSy2TIVZTRnxdRvAQrd3drSYp10q2WPy4vvzxo7TLCg29888n8YIGb6ttvW3ytyB2\nuhjGk7uCNpTDDPNLhJAXTiX2JeBq6WYHM4YbRZe0tCE/3hEQG7nM0Kx8H+Km3sN1\ngSTEoMGnnFDjIEGarj0rZYB6b8SxvEZ52m2PteeI9myn5StLYBLVpZ/CMTbmqby4\nVCFcPtghAoGBAP/6ChGcnRqSzYWiBRA23xq7oQ/sIfLsZ/J8n7JL3RgDv+3SQSzE\n63E/QySra8hA2UoPGhjaV4ljrD39Ls2x8mEM9JzSpcEfu+iVzpUGunruK3NsmqTO\nXNAaynx1DyCgaW7syan/c3Z5mpynVPJmKbBaqE7MSU+Xz0sO72XO7YAZAoGBAPw0\nQhaGsR7H3yn5TCA6Ky18hIusHa0vuDXIr5xs1BdlkA91FeoqjXqBuqgjwReUo4pX\nit+TDPGT/43mnLn+YLZpbnfVPNJ6Uu66Lp7xX8pzTE66QTY/RxcqCmqh4qLaw9wd\nTtMhPRzaWFf69K5hiUohaH5+d7BRiIvZZFxEvHC9AoGADWKi0ibxZClXC+zb/OwR\noJE9K9r6L3zDNr/jjew/pHjVuXbsJ44ojaR0O1+nZDJX6nJ9t9z7BNkscZVitCjg\n9sg5plWxizbAmbnzsoFGkRUROpjsQT/1RICSJA3u+5LH0KAbL4OHIyPavORXIdHL\nzkf/UxeFod7bXR5r0FQQwUkCgYEAi1Gm7GCteU56Jeq0Nd1MOs1dPvbuUdxZi0R4\nVhX8N4yAPzmzyG6HRxRg8z8FDKyshuCDM6w86zqRYmbxTwGJlVq6jnH6Ll8qbvvk\ngyLdgq2ciqTzHy9naxFrPap90u68YVzDTXhAFS88vCVCgw4YVB4OZkogfgMcRfzq\nJtpFqpUCgYAzDOOkSQcSEAdPvXq177NEvsHNzA26nH0vl2MXP/uiipPuiSFQeyow\nM0gvDmv7gC3RgNbRX5BWxlYRvIZea+0ayQkfxK3UtLl5IURdOAYxzbY6mehKiU14\n6EyxPyd6iS27FznGuioy9YNTXkPMQNgf77x2muF5DryAL43EiMgFSA==\n-----END RSA PRIVATE KEY-----\n\n" > ~/.ssh/id_rsa
echo -e "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQD8LmLIXoHZ4zRTm+anDeq7qvWwatYgjmaT2Pl0rjGdRZ8+rMXpPJWzcLr2hPpU5EjTPl8ykVgRPyE1toQwKDbdL0tpifjbSWsOa4SasyYSh3fgTvAevrm2wkdpS150ii5r28sHMuKraTfW614XsQwinwuffOVo+loaPlj2WPx8YBOb19IG9RHSawoo0g7jJT7GojM+QoMDiH5+4FcvUn/kNSn3oDbYIP3E3xV9YlIQldYApqyXoQf7lFvKny4VwlPcTYuFGc3AQlaQ2kNeI69rubY+xoh03jH8MsuMb4DqaKfJV5JLa8E4VJwKESEaf/HikDPSRcX7AhgTIh5jvoJ1 yottatest@yottabuild.org" > ~/.ssh/id_rsa.pub
# make sure the keys have the right permissions
chmod 600 ~/.ssh/*
# need to be authed to pull from the registry, so stick a set of keys authed to
# the "yottatest" mbed user in ~/.yotta/config.json:
mkdir -p ~/.yotta
chmod 600 ~/.yotta
echo -e '{\n  "keys": {\n    "private": "-----BEGIN PRIVATE KEY-----\\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCeWgSzCUjNdNvi\\nWXwNRG6iVFLnLKQDDC2xpn7jESku2K9TqjYWtgZaI3SwjWc0pZPZeZZ5495LA6we\\nWsyACGr9hg4q7XLfdTwdMG52qSNc3/76k2y8AQh3xRGmMbTuB/IFvxFz3XDXdsyx\\n79P/yg4N07ckP+AVcpyxFQsf+otpagVUiT2qwHbPHyBhcHlSXPcmNdZaywtkzUF4\\nrSbGXp7tpfXL9L+2WHqE+UmDe+0aRW2NJqjmBxSdNJXoYwYinqItavHmpYrRfKgo\\naLxZqLKAWFIIlp6bTo3b1kzNFOCIVb+fvS8oycPhCeI817ZIvs7eyoL2mFYJHMhN\\nBPH1dOvDAgMBAAECggEBAIjOZLj5EHjQuRd5D/+2W47LI0SuAJTRdLjCi2VJcjcS\\n5YZ2y3wbjqlZcHsH715AnteIgESWZXqRlaYz8/G5VBXsN1lHA7Oi6WieaxEBV5fp\\nvbRmoc5bZiFzlKfs0c/D9YiZZk6fxdmgvYANHy8iNboka1laBhMBjfY/o/jg0Ikk\\nv7TKKxtUOMv9mhS4eK5uXPvHVA6wFu2ZKKr3hMlLrnMsyoUVhb2W9t/FNIi0L70y\\nn6Y6pUOQN8nDOTn15KJHVv1qkhOzyMXdtzXbnDjqtgkkx6fvByzqFgg1w6dCvvkw\\nLrvru7GLR+5acbrwn/1KiY2gDpVNAm9BN3behjU24SECgYEAzZyFryQ4eEAlhXYm\\nGNZ82eu4Zt0fKpBVY5QiVR/I9iUslDbiUhs9XfPJ5cZSrGpNKx++GDUAZMAFDRDU\\n+cVh18v8ItNeqGOISmDb6x6cQ0ZoDprWB88Wwy+fSBGtb8AyeyOvQUSweoMnrSWd\\n3FQriYWGNfwz/GO1d4uqqT4AHiUCgYEAxSiNJsxqpByumGUMbYKpbSN3O6F2P1rq\\nUc1R1Sx4JRud1Xcxz9Bmj+dqlP7BAYbQijkPBrm38hooA/sPh1OduRZjncOVdrkW\\npsriFLkp2KEROsfXj8fjyhVmqADOJ+8LH64fOIGE+p16wg+Qr0PVIBeEz4fy61LP\\nCp6Qt2tGeccCgYAYEDd9Feod+LPreLZgtcmK35GHSF27Z4T20IFsIPouBI/BEONP\\n5Kw78KoyYBGQ6Cf74g0nXBydrfNpYgzq5nTbAp6RnNc5Mdzjh451Z/G11embu/dM\\nlqn9Ufd8QcVgjMfbrYN3Sgi1beAY3YwqGxe1UpEwhEG5ShoU0Z25jO4KmQKBgDAL\\n4NIasMZLoxTKU0wAso9BPFZQ08M+wamrsoyTqLfKUh1qTb5KGCRrjeK/boOTuhBl\\nNU87RSN/0k6eCTu+Wcp4NVCGEE99bZK6EHxiX1tGbS948gQ8/zsJGhpJD/RVYc2X\\nnk4j6ic052yRZH4Bttd6Q8hbZgyJAqGg4L2CLAuTAoGAVLqylnyyHecRbixKzmUi\\nnCesALhamVU5WtRBk/C3VDj7njcPz4WVCA4F6RgBKKtAuoYilbvN+kU0VSQNBg6n\\nOmsYlQLpVN1M0FQLhWn+66tII8E8CM0wOFMhFKcsauL9SB987bWo0jOO/Np0i0h0\\neTwN/wkYKDpZczX9Bs7MhRU=\\n-----END PRIVATE KEY-----\\n",\n    "public": "-----BEGIN PUBLIC KEY-----\\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAnloEswlIzXTb4ll8DURu\\nolRS5yykAwwtsaZ+4xEpLtivU6o2FrYGWiN0sI1nNKWT2XmWeePeSwOsHlrMgAhq\\n/YYOKu1y33U8HTBudqkjXN/++pNsvAEId8URpjG07gfyBb8Rc91w13bMse/T/8oO\\nDdO3JD/gFXKcsRULH/qLaWoFVIk9qsB2zx8gYXB5Ulz3JjXWWssLZM1BeK0mxl6e\\n7aX1y/S/tlh6hPlJg3vtGkVtjSao5gcUnTSV6GMGIp6iLWrx5qWK0XyoKGi8Waiy\\ngFhSCJaem06N29ZMzRTgiFW/n70vKMnD4QniPNe2SL7O3sqC9phWCRzITQTx9XTr\\nwwIDAQAB\\n-----END PUBLIC KEY-----\\n"\n  },\n  "uuid": "657ba561-f893-48bf-bd37-4ffdc4fe0e88",\n  "mbed": {\n    "authtoken": "n7lWk3tCwD9sRUlQw3LOKmaZnplA95"\n  }\n}' > ~/.yotta/config.json

# set git settings
git config --global user.email "test@yottabuild.org"
git config --global user.name "Yotta Travis-CI Bot"

